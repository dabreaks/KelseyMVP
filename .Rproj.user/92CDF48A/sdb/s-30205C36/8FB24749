{
    "contents" : "#############################\n# Workflow - Nutrition\n# scale - National, Tanzania\n# 24 July 2015 - ongoing\n#\n# input the following modules from the 2012-2013 LSMS from Tanzania\n#   hh_sec_a, \n#   hh_sec_b, \n#   hh_sec_v\n\n# calculate the four nutrition indicators:\n#   % stunted\n#   % wasted\n#   % underweight\n#   % overweight\n#\n# output the 4 indicators at the given scale for the given time period\n#############################\n\n#################\n# Staging\n#################\n\n# where the lsms data is\ndir_lsms <- \"C:/Users/Kyle DeRosa/Dropbox/'EI- Vital Signs/R coding of Threads/External Datasets/TZA LSMS/NPS 2013/TZA_2012_LSMS_v01_M_STATA_English_labels\"\n# where the WHO reference anthro tables are\ndir_anthro <- \"C:/Users/Kyle DeRosa/Dropbox/'EI- Vital Signs/R coding of Threads/External Datasets/WHO Anthro reference tables\"\n# where the output goes\ndir_output <- \"C:/Users/Kyle DeRosa/Dropbox/'EI- Vital Signs/R coding of Threads/Nutrition/output data\"\n\n# where the other .R files are\ndir_r <- \"C:/Users/Kyle DeRosa/Dropbox/'EI- Vital Signs/R coding of Threads/Nutrition/New code/igrowup_R\"\n\n# Package needed to import STATA files\nlibrary(foreign)\n\n# WHO anthropometric prevalence functino\nsource(paste(dir_r, \"igrowup_standard.R\", sep = \"/\"))\n\n# set name for output file\noutfile <- \"TZA.National\"\n\n# Read datasets and only keep variables for nutrition thread\nsetwd(dir_lsms)\n\n# Date of interview\nhh_sec_a <- read.dta(\"HH_SEC_A.dta\")\n# Household, individual ID, Sex\nhh_sec_b <- read.dta(\"HH_SEC_B.dta\")\n# Height, Weight, Upper arm circumference, Measure\nhh_sec_v <- read.dta(\"HH_SEC_V.dta\")\n\n# Date of interview: day=hh_a18_1; month=hh_a18_2; year=hh_a18_3\nhh_sec_a <- subset(hh_sec_a, \n                   select = c(y3_hhid, hh_a18_1, hh_a18_2,hh_a18_3, y3_weight))\n# sex = hh_b02, year of birth=hh_b03_1, month of birth=hh_b03_2\nhh_sec_b <- subset(hh_sec_b, \n                   select = c(y3_hhid, indidy3, hh_b02, hh_b03_1, hh_b03_2))\n# weight=hh_v03; lenhei=hh_v04;  armc=hh_v07; measure=hh_v05 \nhh_sec_v <- subset(hh_sec_v, \n                   select = c(y3_hhid, indidy3, hh_v03, hh_v04, hh_v07, hh_v05))\n\n# Download the file \"igrowup_R.zip\" to a basic directory (here:Tools/igrowup_R)\nsetwd(dir_anthro)\n\n# Restore reference data sets\nweianthro <- read.table(\"weianthro.txt\", header = T, sep = \"\", skip = 0) \nlenanthro <- read.table(\"lenanthro.txt\", header = T, sep = \"\", skip = 0) \nbmianthro <- read.table(\"bmianthro.txt\", header = T, sep = \"\", skip = 0) \nhcanthro <- read.table(\"hcanthro.txt\", header = T, sep = \"\", skip = 0) \nacanthro <- read.table(\"acanthro.txt\", header = T, sep = \"\", skip = 0) \nssanthro <- read.table(\"ssanthro.txt\", header = T, sep = \"\", skip = 0) \ntsanthro <- read.table(\"tsanthro.txt\", header = T, sep = \"\", skip = 0) \nwflanthro <- read.table(\"wflanthro.txt\", header = T, sep = \"\", skip = 0) \nwfhanthro <- read.table(\"wfhanthro.txt\", header = T, sep = \"\", skip = 0)\n\n# Merge datasets into one \"nutrition\" dataset\nnutrition <- merge(hh_sec_a, hh_sec_b, by = \"y3_hhid\", all = TRUE)\nnutrition <- merge(nutrition, hh_sec_v, by = c(\"y3_hhid\", \"indidy3\"))\n\nrm(hh_sec_a, hh_sec_b, hh_sec_v)\n\n# Household and individual ID\n# N23. Gender (M=1, F=2)\nnutrition$sex <- as.integer(nutrition$hh_b02)\n\nnutrition$hh_b02 <- NULL\n\n# N24. Age\nattach(nutrition)\n\nnutrition$interviewmonth <- as.integer(as.factor(hh_a18_2))\n\n# we calculate age based on the date of the interview minus an individuals\n#  birthdate to a precision of month and year. For individuals who report\n#  no month, we impute using a random uniform distribution [1,12]\nmonths <- c(\"JANUARY\", \n            \"FEBRUARY\", \n            \"MARCH\", \n            \"APRIL\", \n            \"MAY\", \n            \"JUNE\", \n            \"JULY\", \n            \"AUGUST\", \n            \"SEPTEMBER\", \n            \"OCTOBER\", \n            \"NOVEMBER\", \n            \"DECEMBER\")\n\nn <- length(hh_b03_2[hh_b03_2 == \"DON'T KNOW\" | is.na(hh_b03_2)] )\n\nset.seed(48749)\n\nmissing.months <- months[floor(runif(n, min = 1, max = 13))]\n\nhh_b03_2[hh_b03_2 == \"DON'T KNOW\" | is.na(hh_b03_2)] <- missing.months\n\nnutrition$birthmonth <- as.integer(hh_b03_2)\n\ndetach(nutrition)\n\n# age in months\nnutrition$age <- (nutrition$hh_a18_3 - nutrition$hh_b03_1) * 12 + \n  (nutrition$interviewmonth - nutrition$birthmonth)\n\n# N25. Height / N26. Weight / N27. Upper arm circumference\n\n# weight:hh_v03; lenhei:hh_v04;  armc: hh_v07; measure: hh_v05\nnames(nutrition)[names(nutrition) == \"hh_v03\"] <- \"weight\"\nnames(nutrition)[names(nutrition) == \"hh_v04\"] <- \"lenhei\"\nnames(nutrition)[names(nutrition) == \"hh_v07\"] <- \"armc\"\n\n# measure:hh_v05\nnutrition$measure[nutrition$hh_v05 == \"STANDING\"] <- \"1\"\nnutrition$measure[nutrition$hh_v05 == \"LYING DOWN\"] <- \"2\"\n\nvars <- c(\"age\", \"weight\", \"lenhei\", \"armc\", \"measure\", \"sex\", \"y3_weight\")\n\nnutrition <- nutrition[ , vars]\n\n#################\n# Analysis\n#################\n\n# execute WHO anthro prevalence\nigrowup.standard(FilePath = dir_output,\n                 FileLab = outfile,\n                 mydf = nutrition,\n                 sex = sex,\n                 age = age,\n                 age.month = T, \n                 weight = weight, \n                 lenhei = lenhei,\n                 measure = measure, \n                 armc = armc,\n                 sw = y3_weight)\n",
    "created" : 1438619545305.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "772325202",
    "id" : "8FB24749",
    "lastKnownWriteTime" : 1438619563,
    "path" : "~/GitHub/KelseyMVP/Nutrition.TZA.National.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}